# ~~ Generated by cdk-express-pipeline. To modify, edit your pipeline and run `cdk synth`
name: CDK Diff Action
description: Run CDK diff for a specific stack pattern and post results to PR
inputs:
  stack-selector-patterns:
    required: true
    description: The value of the {stackSelector} replacement in the command
  command:
    required: true
    description: CDK diff command
  cloud-assembly-directory:
    required: true
    description: The directory where the CDK cloud assembly is located
  github-token:
    required: true
    description: GitHub token for posting comments
  assume-role-arn:
    required: true
    description: The ARN of the role to assume for the deploy operation
  assume-region:
    required: true
    description: The AWS region to assume for the deploy operation
  job-name:
    required: false
    description: The name of the job, to correctly link to the action logs when using a Matrix.
runs:
  using: composite
  steps:
    - name: Restore Build Cache
      uses: actions/cache/restore@v4
      with:
        key: cache-build-${{ github.sha }}-${{ inputs.cloud-assembly-directory }}
        path: |-
          cdk.out/
          node_modules/
    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v4
      with:
        role-to-assume: ${{ inputs.assume-role-arn }}
        aws-region: ${{ inputs.assume-region }}

    - name: CDK Diff Generate
      uses: rehanvdm/cdk-express-pipeline-github-diff@feature/init
      with:
        mode: generate
        cloud-assembly-directory: ${{ inputs.cloud-assembly-directory }}
        stack-selectors: ${{ inputs.stack-selector-patterns }}
        github-token: ${{ inputs.github-token }}
        job-name: ${{ inputs.job-name }}

